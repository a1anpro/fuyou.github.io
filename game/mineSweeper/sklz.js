"use strict";function _slicedToArray(t,a){return _arrayWithHoles(t)||_iterableToArrayLimit(t,a)||_unsupportedIterableToArray(t,a)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,a){if(t){if("string"==typeof t)return _arrayLikeToArray(t,a);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,a):void 0}}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,r=new Array(a);e<a;e++)r[e]=t[e];return r}function _iterableToArrayLimit(t,a){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var r,n,o=[],l=!0,i=!1;try{for(e=e.call(t);!(l=(r=e.next()).done)&&(o.push(r.value),!a||o.length!==a);l=!0);}catch(t){i=!0,n=t}finally{try{l||null==e.return||e.return()}finally{if(i)throw n}}return o}}function _arrayWithHoles(t){if(Array.isArray(t))return t}var es=function(t){return document.querySelectorAll(t)},e=function(t){return document.querySelector(t)},log=console.log.bind(console),SHOW_MAP={NUMBER:1,CELL:0,BLACK_BOOM:-1,RED_BOOM:-2,EMPTY:-3,FLAG:-4,QUESTION:-5},genMap=function(n){for(var a=[[-1,0],[-1,-1],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1]],e=n.length,t=function(r){for(var t=0;t<e;t+=1)!function(e){9===n[r][e]&&a.forEach(function(t){var a=r+t[0],t=e+t[1];0<=a&&0<=t&&a<9&&t<9&&9!==n[a][t]&&(n[a][t]+=1)})}(t)},r=0;r<e;r+=1)t(r);return n},drawCell=function(t,a,e,r){t.drawImage(a,(e-1)*cellSize,(r-1)*cellSize)},drawRow=function(t,a,e){for(var r=1;r<=9;r+=1)drawCell(t,cell,r,e)},drawSquare=function(t){for(var a=1;a<=9;a+=1)drawRow(t,cell,a)},drawText=function(t,a,e,r){t.font="bold 20px Arial";t.fillStyle={1:"blue",2:"green",3:"red",4:"#04207f",5:"#800f00",6:"#067f7f",7:"black",8:"#808080"}[a],t.fillText(a,8+25*(e-1),25*(r-1)+20)},getPos=function(t,a){return[Math.ceil(t/25),Math.ceil(a/25)]},renderSquare=function(t){for(var a=0;a<9;a+=1)for(var e=0;e<9;e+=1){var r=statusMap[a][e];r===SHOW_MAP.NUMBER?drawText(gameCtx,gameMap[a][e].toString(),a+1,e+1):r===SHOW_MAP.BLACK_BOOM?drawCell(gameCtx,blackBoom,a+1,e+1):r===SHOW_MAP.RED_BOOM?drawCell(gameCtx,redBoom,a+1,e+1):r===SHOW_MAP.EMPTY?drawCell(gameCtx,empty,a+1,e+1):r===SHOW_MAP.FLAG?drawCell(gameCtx,flagImg,a+1,e+1):r===SHOW_MAP.QUESTION?drawCell(gameCtx,questionImg,a+1,e+1):r===SHOW_MAP.CELL&&drawCell(gameCtx,cell,a+1,e+1)}},vjklAll=function(){for(var t=0;t<9;t+=1)for(var a=0;a<9;a+=1)9===gameMap[t][a]&&(statusMap[t][a]=-1)},vjklAround=function(r,n,t){vjklSelf(r,n,t);[[-1,-1],[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0]].forEach(function(t){var a=r+t[0],e=n+t[1];0<=a&&0<=e&&a<9&&e<9&&(0===(t=gameMap[a][e])?vjklSelf(a,e,-3):9!==t&&vjklSelf(a,e,1))})},vjklSelf=function(t,a,e){0<=t&&0<=a&&t<9&&a<9&&(0===statusMap[t][a]&&0===gameMap[t][a]?(statusMap[t][a]=e,vjklAround(t,a,e)):statusMap[t][a]=e)},handleClick=function(t,a,e,r){var n=a-1,a=e-1;firstClick&&(firstClick=!1,gameMap[n][a]=0),0===r?9===(e=gameMap[n][a])?(vjklAll(),statusMap[n][a]=-2):0===e?vjklAround(n,a,-3):vjklSelf(n,a,1):2===r&&(r=statusMap[n][a],log("status:",r),0===r?statusMap[n][a]=-4:-4===r?statusMap[n][a]=-5:-5===r&&(statusMap[n][a]=0)),renderSquare(t)},bindEventDelegate=function(t,r){t.addEventListener("mousedown",function(t){var a=t.button,e=_slicedToArray(getPos(t.offsetX,t.offsetY),2),t=e[0],e=e[1];handleClick(r,t,e,a)})},gameStart=function(){firstClick=!0,initMap(),drawSquare(gameCtx),drawSquare(testCtx);for(var t=0;t<9;t+=1)for(var a=0;a<9;a+=1)drawText(testCtx,gameMap[t][a],t+1,a+1)},run=function(){gameStart(),bindEventDelegate(gameCanvas,gameCtx)},genRandom=function(){return Math.floor(Math.random()*Math.floor(9))},genTestData=function(){for(var t=12,a=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]];t;)a[genRandom()][genRandom()]=9,--t;return a},initMap=function(){data=genTestData(),gameMap=genMap(data),statusMap=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]},gameCanvas=e("#id-game-canvas"),gameCtx=gameCanvas.getContext("2d"),testCanvas=e("#id-test-canvas"),testCtx=testCanvas.getContext("2d"),cell=new Image,redBoom=new Image,blackBoom=new Image,empty=new Image,flagImg=new Image,questionImg=new Image;cell.src="./static/cell.png",redBoom.src="./static/red_boom.png",blackBoom.src="./static/black_boom.png",empty.src="./static/empty.png",flagImg.src="./static/flag.png",questionImg.src="./static/question.png";var cellSize=25,data=null,gameMap=null,statusMap=null,firstClick=!0,_main=function(){redBoom.onload=function(){run()}};_main();