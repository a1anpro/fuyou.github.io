"use strict";function ownKeys(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach(function(t){_defineProperty(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function _iterableToArrayLimit(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,a,r=[],o=!0,h=!1;try{for(i=i.call(t);!(o=(n=i.next()).done)&&(r.push(n.value),!e||r.length!==e);o=!0);}catch(t){h=!0,a=t}finally{try{o||null==i.return||i.return()}finally{if(h)throw a}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}var genRandom=function(){return Math.floor(Math.random()*Math.floor(9))},CELL_SIZE=80,IMG_MAPPER={1:"bird",2:"brown",3:"fox",4:"frog",5:"hippo",6:"owl"},STATUS_STATIC=1,STATUS_DYNAMIC=2,STATUS_DISPOSABLE=3,number_config={1:{x:96,y:80,width:36,height:40},4:{x:0,y:0,width:36,height:40},8:{x:0,y:42,width:36,height:40},2:{x:0,y:80,width:36,height:40},6:{x:34,y:0,width:36,height:40},7:{x:34,y:42,width:36,height:40},5:{x:34,y:80,width:30,height:40},9:{x:68,y:0,width:36,height:40},0:{x:68,y:42,width:36,height:40},3:{x:68,y:80,width:26,height:40}},static_config={numbers:{name:"numbers",path:"./static/numbers.png",width:116,height:118,count:1,index:0},background:{name:"background",path:"./static/background.png",width:720,height:1280,count:1,index:0},wall:{name:"wall",path:"./static/wall.png",width:75,height:75,count:1,index:0},bird:{name:"bird",path:"./static/bird.png",width:65,height:65,count:1,index:0},brown:{name:"brown",path:"./static/brown.png",width:68,height:65,count:1,index:0},fox:{name:"fox",path:"./static/fox.png",width:71,height:63,count:1,index:0},frog:{name:"frog",path:"./static/frog.png",width:69,height:65,count:1,index:0},hippo:{name:"hippo",path:"./static/hippo.png",width:63,height:64,count:1,index:0}},dynamic_config={dynamic_bird:{name:"dynamic_bird",path:"./static/animation/dynamic_bird.png",width:66,height:65,count:10,index:0},dynamic_brown:{name:"dynamic_brown",path:"./static/animation/dynamic_brown.png",width:70,height:65,count:10,index:0},dynamic_fox:{name:"dynamic_fox",path:"./static/animation/dynamic_fox.png",width:68,height:63,count:7,index:0},dynamic_frog:{name:"dynamic_frog",path:"./static/animation/dynamic_frog.png",width:70,height:65,count:9,index:0},dynamic_hippo:{name:"dynamic_hippo",path:"./static/animation/dynamic_hippo.png",width:64,height:65,count:8,index:0},dynamic_bubble:{name:"dynamic_bubble",path:"./static/animation/dynamic_bubble.png",width:94,height:75,count:2,index:1}},highlight_config={highlight_bird:{name:"highlight_bird",path:"./static/animation/highlight_bird.png",width:77,height:75,count:4,index:0},highlight_brown:{name:"highlight_brown",path:"./static/animation/highlight_brown.png",width:78,height:68,count:8,index:0},highlight_fox:{name:"highlight_fox",path:"./static/animation/highlight_fox.png",width:77,height:70,count:4,index:0},highlight_frog:{name:"highlight_frog",path:"./static/animation/highlight_frog.png",width:81,height:70,count:7,index:0},highlight_hippo:{name:"highlight_hippo",path:"./static/animation/highlight_hippo.png",width:75,height:70,count:5,index:0}},MOUSE_TYPE={LEFT_CLICK:0,RIGHT_CLICK:2},getEmptySquare=function(t,e){for(var i=[],n=0;n<e;n++){for(var a=[],r=0;r<t;r++)a.push(0);i.push(a)}return i},drawVerticalLine=function(t,e,i){t.beginPath(),t.strokeStyle="black";for(var n=0;n<=e;n++)t.moveTo(80*n,0),t.lineTo(80*n,i);t.closePath(),t.stroke()},drawHorizontalLine=function(t,e,i){t.beginPath(),t.strokeStyle="black";for(var n=0;n<=e;n++)t.moveTo(0,80*n),t.lineTo(i,80*n);t.closePath(),t.stroke()},drawText=function(t,e,i,n){var a=number_config[e],r=a.x,o=a.y,e=a.width,a=a.height;t.drawImage(images.numbers,r,o,e,a,80*n+(CELL_SIZE-e)/2-5,80*i+(CELL_SIZE-a)/2,e+20,a+20)},drawGrid=function(t){drawVerticalLine(t,10,800),drawHorizontalLine(t,10,800)},clearSquare=function(t){t.fillStyle="#dee0e1",t.fillRect(0,0,width*CELL_SIZE,height*CELL_SIZE),t.drawImage(images.background,0,0,800,800,0,0,1e3,1e3)},draw=function(t){var e=t.x,i=t.y,n=t.alive,a=t.staticConf,r=t.dynamic,o=a.width,t=a.height,a=a.name;_.isUndefined(r)?n&&gameCtx.drawImage(images[a],e+(CELL_SIZE-o)/2,i+(CELL_SIZE-t)/2):(a=r.name,o=r.width,t=r.height,r=r.index,n&&gameCtx.drawImage(images[a],r*o,0,o,t,e+(CELL_SIZE-o)/2,i+(CELL_SIZE-t)/2,o,t)),drawText(gameCtx,arroundArray.length,mousePosition[0],mousePosition[1])},update=function(e){var t=e.dynamic;-1===_.findIndex(arroundArray,function(t){return t.id===e.id&&t.x===e.x&&t.y===e.y})&&t&&(log("不在其中, 且有dynamic"),delete e.dynamic);for(var i=0;i<arroundArray.length;i++){var n=arroundArray[i];_.isUndefined(n.dynamic)&&getHighlightAnimation(n)}!_.isUndefined(t)&&e.alive&&(t.index+=1,"dynamic_bubble"===t.name&&t.index>=t.count&&(e.alive=!1,log("消除:",e)),t.index%=t.count)},getHighlightAnimation=function(t){t.x,t.y;var e=t.name,e=highlight_config["highlight_"+e];t.dynamic=e},setBubble=function(t){var e=dynamic_config.dynamic_bubble;t.dynamic=e},listenDrop=function(){for(var t=0;t<10;t++)for(var e,i,n=!1,a=0,r=9;0<=r;r--)!1===gameMap[r][t].alive&&(a+=1,n=!0),n&&gameMap[r][t].alive&&(e=gameMap[r][t],i=gameMap[r+a][t],drop(t,e,i.y,[r,t],[r+a,t]))},renderSquare=function(o){setInterval(function(){clearSquare(o);for(var t=0;t<height;t+=1)for(var e=0;e<width;e+=1){var i=gameMap[t][e];update(i)}for(var n=0;n<height;n+=1)for(var a=0;a<width;a+=1){var r=gameMap[n][a];log("eee",r),draw(r)}listenDrop()},200)},drop=function i(n,a,r,o,h){setTimeout(function(){if(a.y+9>r){a.y=r;var t=h[0],e=h[1];return gameMap[t][e]=_.cloneDeep(a),void(gameMap[o[0]][o[1]].alive=!1)}a.y+=10,i(n,a,r,o,h)},1e3/60)},getPos=function(t,e){return[Math.ceil(t/CELL_SIZE),Math.ceil(e/CELL_SIZE)]},removeAround=function(t,e,i,n){if(n===MOUSE_TYPE.LEFT_CLICK&&1<arroundArray.length){log("现在点亮的:",arroundArray);for(var a=0;a<arroundArray.length;a++){var r=arroundArray[a];setBubble(r)}}},handleDoubleClick=function(t){var e=t.button,i=_slicedToArray(getPos(t.offsetX,t.offsetY),2),t=i[0],i=i[1];log("双击",i-1,t-1),mousePosition=[-1,-1],removeAround(gameCtx,i-1,t-1,e)},highlightAround=function a(r,o){var h=gameMap[r][o];statusMap[r][o]=1,arroundArray.push(h),log("arroundArray",arroundArray);[[-1,0],[1,0],[0,1],[0,-1]].forEach(function(t){var e,i=r+t[0],n=o+t[1];0<=i&&0<=n&&i<width&&n<height&&(e=gameMap[i][n],t=statusMap[i][n],e.name===h.name&&0===t&&(statusMap[i][n]=1,a(i,n)))})},handleSingleClick=function(t){var e=_slicedToArray(getPos(t.offsetX,t.offsetY),2),t=e[0],e=e[1]-1,t=t-1;mousePosition[0]=e,mousePosition[1]=t,log("单击:",mousePosition),arrayEquals(mousePosition,beforeMousePosition)?log("鼠标未变"):(beforeMousePosition[0]=e,beforeMousePosition[1]=t,arroundArray=[],highlightAround(e,t),statusMap=getEmptySquare(width,height))},bindEventDelegate=function(t){t.addEventListener("mousedown",handleSingleClick),t.addEventListener("dblclick",handleDoubleClick)},initGlobalData=function(){gameOver=!1,firstClick=!0,statusMap=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]]},gameCanvas=e("#id-game-canvas"),gameCtx=gameCanvas.getContext("2d"),height=10,width=10,images={},gameMap=[],statusMap=[],beforeMousePosition=[-1,-1],mousePosition=[-1,-1],arroundArray=[],_start=function(){renderSquare(gameCtx),bindEventDelegate(gameCanvas)},getSquare=function(){return[[5,1,5,3,2,1,4,5,2,5],[2,2,2,4,3,2,4,5,4,2],[3,4,2,2,1,1,1,5,4,2],[3,3,4,4,4,2,2,2,1,5],[2,2,5,1,2,1,2,5,1,5],[1,1,1,4,2,3,3,4,5,1],[2,3,2,4,3,1,5,3,3,1],[2,2,5,1,1,1,3,3,3,5],[1,2,4,2,3,4,1,1,1,1],[4,5,1,1,1,5,4,1,3,1]]},getStaticElement=function(t,e,i){var n=IMG_MAPPER[t[e][i]];return{id:t[e][i],name:n,x:i*CELL_SIZE,y:e*CELL_SIZE,alive:!0,staticConf:_.cloneDeep(static_config[n])}},genMap=function(t){for(var e=[],i=0;i<height;i++){for(var n=[],a=0;a<width;a++){var r=getStaticElement(t,i,a);n.push(r)}e.push(n)}return log("map",e),e},_init=function(){var t=getSquare();gameMap=genMap(t),statusMap=getEmptySquare(width,height),_start()},loadAssets=function(n,a){for(var r=Object.keys(n),o=0,t=0;t<r.length;t++)!function(t){var e=r[t],t=n[e].path,i=new Image;i.src=t,i.onload=function(){a[e]=i,(o+=1)==r.length&&_init()}}(t)},run=function(){var t=_objectSpread(_objectSpread(_objectSpread({},static_config),highlight_config),dynamic_config);loadAssets(t,images)},_main=function(){run()};_main();
//# sourceMappingURL=../maps/popstar/index.js.map
