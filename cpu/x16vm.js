var debug=!0,debug_print=function(...e){1==debug&&log(...e)};class AxePu{constructor(e){this.registers={pa:0,a1:0,a2:0,a3:0,c1:0,f1:0},this.reg_mapper=get_reg_mapper(),this.memory=e}do_next_ins(){var e=this.registers.pa;if(e>=this.memory.length)return!1;var r=this.memory;if(0==r[e]){log("竟然走到了set这里,pa=",e,r[e]),this.registers.pa+=3;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2];this.registers[t]=i,debug_print("set ",t,i)}else if(8==r[e]){this.registers.pa+=4;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=r[e+3],p=restore_from_little(i,g);this.registers[t]=p,debug_print("set2 ",t,p)}else if(3==r[e]){this.registers.pa+=3;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2];r[i]=this.registers[t],debug_print("save",t,i)}else if(11==r[e]){this.registers.pa+=4;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=r[e+3],p=restore_from_little(i,g),_=this.registers[t];_=apart_data(_),r[p]=_[0],r[p+1]=_[1],debug_print("save2",t,p)}else if(1==r[e]){this.registers.pa+=3;let s=r[e+1],t=r[e+2],i=this.reg_mapper[t];this.registers[i]=r[s],debug_print("load",s,i)}else if(9==r[e]){this.registers.pa+=4;let s=restore_from_little(r[e+1],r[e+2]),t=r[s],i=r[s+1],g=restore_from_little(t,i),p=r[e+3],_=this.reg_mapper[p];this.registers[_]=g,debug_print("load2",s,_)}else if(10==r[e]){this.registers.pa+=4;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=this.reg_mapper[i],p=r[e+3],_=this.reg_mapper[p];this.registers[_]=this.registers[t]+this.registers[g],debug_print("add2",t,g,_)}else if(2==r[e]){this.registers.pa+=4;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=this.reg_mapper[i],p=r[e+3],_=this.reg_mapper[p];this.registers[_]=this.registers[t]+this.registers[g],debug_print("add",t,g,_)}else if(12==r[e]){this.registers.pa+=4;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=this.reg_mapper[i],p=r[e+3],_=this.reg_mapper[p];this.registers[_]=this.registers[t]-this.registers[g],debug_print("subtract2",t,g,_)}else if(7==r[e]){this.registers.pa+=3;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=this.reg_mapper[i];r[read_low_8bit(this.registers[g])]=read_low_8bit(this.registers[t]),debug_print("save_from_register",t,g)}else if(15==r[e]){this.registers.pa+=3;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=this.reg_mapper[i],p=this.registers[g],_=this.registers[t];_=apart_data(_),debug_print("data[0][1]:",_[0],_[1]),r[p]=_[0],r[p+1]=_[1],debug_print("save_from_register2",t,g)}else if(13==r[e]){this.registers.pa+=3;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=this.reg_mapper[i],p=read_low_8bit(this.registers[t]);this.registers[g]=read_low_8bit(r[p]),debug_print("load_from_register",t,g)}else if(14==r[e]){this.registers.pa+=3;let s=r[e+1],t=this.reg_mapper[s],i=r[e+2],g=this.reg_mapper[i],p=this.registers[t],_=r[p],a=r[p+1],h=restore_from_little(_,a);this.registers[g]=h,debug_print("load_from_register2",t,g)}else if(16==r[e]){let s=r[e+1],t=this.reg_mapper[s];this.registers.pa=this.registers[t],debug_print("jump_from_register",t,this.registers[t])}else if(6==r[e]){let s=r[e+1],t=r[e+2],i=restore_from_little(s,t);this.registers.pa=i,debug_print("jump",i)}else if(5==r[e]){let s=r[e+1],t=r[e+2],i=restore_from_little(s,t);2==this.registers.c1?this.registers.pa=i:this.registers.pa+=3,debug_print("jump_if_less",i)}else if(4==r[e]){this.registers.pa+=3;let s=r[e+1],t=this.reg_mapper[s],i=this.registers[t],g=r[e+2],p=this.reg_mapper[g],_=this.registers[p];this.registers.c1=i<_?2:i>_?1:0,debug_print("compare",t,p)}else{if(255!=r[e])return debug_print("指令错误的pa:",e,r[e]),window.alert("错误指令"),!1;this.registers.pa+=1,debug_print("halt, ",this.registers.pa)}return this.memory=r,!0}get_all_registers(e){return this.registers}get_register(e){return this.registers[e]}get_memory(e){return this.memory}run(){for(var e=!0;1==e;)e=this.do_next_ins();return this.memory}}
