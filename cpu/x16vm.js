"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var s=0;s<r.length;s++){var t=r[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,s){return r&&_defineProperties(e.prototype,r),s&&_defineProperties(e,s),e}var debug=!0,debug_print=function(){1==debug&&log.apply(void 0,arguments)},AxePu=function(){function r(e){_classCallCheck(this,r),this.registers={pa:0,a1:0,a2:0,a3:0,c1:0,f1:0},this.reg_mapper=get_reg_mapper(),this.memory=e}return _createClass(r,[{key:"do_next_ins",value:function(){var e=this.registers.pa;if(e>=this.memory.length)return!1;var r=this.memory;if(0==r[e]){log("竟然走到了set这里,pa=",e,r[e]),this.registers.pa+=3;var s=r[e+1],t=this.reg_mapper[s],s=r[e+2];this.registers[t]=s,debug_print("set ",t,s)}else if(8==r[e]){this.registers.pa+=4;var i=r[e+1],t=this.reg_mapper[i],s=r[e+2],i=r[e+3],i=restore_from_little(s,i);this.registers[t]=i,debug_print("set2 ",t,i)}else if(3==r[e]){this.registers.pa+=3;var a=r[e+1],i=this.reg_mapper[a],a=r[e+2];r[a]=this.registers[i],debug_print("save",i,a)}else if(11==r[e]){this.registers.pa+=4;var a=r[e+1],g=this.reg_mapper[a],p=r[e+2],a=r[e+3],p=restore_from_little(p,a),a=this.registers[g],a=apart_data(a);r[p]=a[0],r[p+1]=a[1],debug_print("save2",g,p)}else if(1==r[e]){this.registers.pa+=3;g=r[e+1],p=r[e+2],p=this.reg_mapper[p];this.registers[p]=r[g],debug_print("load",g,p)}else if(9==r[e]){this.registers.pa+=4;var _=restore_from_little(r[e+1],r[e+2]),h=r[_],n=r[_+1],h=restore_from_little(h,n),n=r[e+3],n=this.reg_mapper[n];this.registers[n]=h,debug_print("load2",_,n)}else if(10==r[e]){this.registers.pa+=4;h=r[e+1],_=this.reg_mapper[h],n=r[e+2],h=this.reg_mapper[n],n=r[e+3],n=this.reg_mapper[n];this.registers[n]=this.registers[_]+this.registers[h],debug_print("add2",_,h,n)}else if(2==r[e]){this.registers.pa+=4;var l=r[e+1],o=this.reg_mapper[l],m=r[e+2],l=this.reg_mapper[m],m=r[e+3],m=this.reg_mapper[m];this.registers[m]=this.registers[o]+this.registers[l],debug_print("add",o,l,m)}else if(12==r[e]){this.registers.pa+=4;o=r[e+1],l=this.reg_mapper[o],m=r[e+2],o=this.reg_mapper[m],m=r[e+3],m=this.reg_mapper[m];this.registers[m]=this.registers[l]-this.registers[o],debug_print("subtract2",l,o,m)}else if(7==r[e]){this.registers.pa+=3;var u=r[e+1],f=this.reg_mapper[u],d=r[e+2],b=this.reg_mapper[d];r[read_low_8bit(this.registers[b])]=read_low_8bit(this.registers[f]),debug_print("save_from_register",f,b)}else if(15==r[e]){this.registers.pa+=3;u=r[e+1],d=this.reg_mapper[u],f=r[e+2],b=this.reg_mapper[f],u=this.registers[b],f=this.registers[d],f=apart_data(f);debug_print("data[0][1]:",f[0],f[1]),r[u]=f[0],r[u+1]=f[1],debug_print("save_from_register2",d,b)}else if(13==r[e]){this.registers.pa+=3;var c=r[e+1],v=this.reg_mapper[c],y=r[e+2],w=this.reg_mapper[y],c=read_low_8bit(this.registers[v]);this.registers[w]=read_low_8bit(r[c]),debug_print("load_from_register",v,w)}else if(14==r[e]){this.registers.pa+=3;y=r[e+1],c=this.reg_mapper[y],v=r[e+2],w=this.reg_mapper[v],y=this.registers[c],v=r[y],y=r[y+1],y=restore_from_little(v,y);this.registers[w]=y,debug_print("load_from_register2",c,w)}else if(16==r[e]){var k=r[e+1],k=this.reg_mapper[k];this.registers.pa=this.registers[k],debug_print("jump_from_register",k,this.registers[k])}else if(6==r[e]){var k=r[e+1],C=r[e+2],C=restore_from_little(k,C);this.registers.pa=C,debug_print("jump",C)}else if(5==r[e]){var P=r[e+1],j=r[e+2],x=restore_from_little(P,j);2==this.registers.c1?this.registers.pa=x:this.registers.pa+=3,debug_print("jump_if_less",x)}else if(4==r[e]){this.registers.pa+=3;C=r[e+1],P=this.reg_mapper[C],j=this.registers[P],x=r[e+2],C=this.reg_mapper[x],x=this.registers[C];this.registers.c1=j<x?2:x<j?1:0,debug_print("compare",P,C)}else{if(255!=r[e])return debug_print("指令错误的pa:",e,r[e]),window.alert("错误指令"),!1;this.registers.pa+=1,debug_print("halt, ",this.registers.pa)}return this.memory=r,!0}},{key:"get_all_registers",value:function(e){return this.registers}},{key:"get_register",value:function(e){return this.registers[e]}},{key:"get_memory",value:function(e){return this.memory}},{key:"run",value:function(){for(var e=!0;1==e;)e=this.do_next_ins();return this.memory}}]),r}();
//# sourceMappingURL=../maps/cpu/x16vm.js.map
